{% extends 'base.html' %}
{% block title %}Annuaire – StopVerifAge{% endblock %}
{% block content %}
<h1>Annuaire des sites vérifiés</h1>
<p>Recherchez et filtrez les sites qui imposent une vérification d'identité.</p>

<!-- Barre de recherche simplifiée -->
<form class="row gy-2 gx-3 align-items-end mb-3" method="get" action="{{ url_for('sites') }}">
  <div class="col-md-8">
    <input type="text" class="form-control" id="q" name="q" value="{{ q }}" placeholder="Rechercher un site…">
  </div>
  <div class="col-md-3 d-grid">
    <button type="submit" class="btn btn-primary">Rechercher</button>
  </div>
  {% if selected_category or selected_country %}
  <div class="col-md-1 d-grid">
    <a href="{{ url_for('sites') }}" class="btn btn-secondary">Réinitialiser</a>
  </div>
  {% endif %}
</form>

<!-- Filtres par tags -->
<div class="mb-4">
  <strong>Catégories :</strong>
  <a href="{{ url_for('sites') }}" class="badge bg-secondary text-decoration-none me-1 {% if not selected_category %}active{% endif %}">Toutes</a>
  {% for cat in categories %}
    <a href="{{ url_for('sites', category=cat) }}" class="badge bg-info text-dark text-decoration-none me-1 {% if cat == selected_category %}active{% endif %}">{{ cat }}</a>
  {% endfor %}
  <br>
  <strong>Régions :</strong>
  <a href="{{ url_for('sites', category=selected_category) }}" class="badge bg-secondary text-decoration-none me-1 {% if not selected_country %}active{% endif %}">Toutes</a>
  {% for c in countries %}
    <a href="{{ url_for('sites', category=selected_category, country=c) }}" class="badge bg-warning text-dark text-decoration-none me-1 {% if c == selected_country %}active{% endif %}">{{ c }}</a>
  {% endfor %}
</div>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nom du site</th>
        <th>Tags</th>
        <th>Méthode de vérification</th>
        <th>Statut</th>
      </tr>
    </thead>
    <tbody>
      {% if sites %}
        {% for site in sites %}
          <tr>
            <td><a href="{{ url_for('site_detail', site_id=site['id']) }}">{{ site['name'] }}</a></td>
            <td>
              <span class="badge bg-info text-dark me-1">{{ site['category'] }}</span>
              <span class="badge bg-warning text-dark">{{ site['country'] }}</span>
            </td>
            <td>{{ site['verification_type'] }}</td>
            <td>{{ site['status'] }}</td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="4">Aucun site ne correspond à vos critères.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}